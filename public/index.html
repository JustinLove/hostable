<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Hostable</title>
  <!--link href="style.css" rel="stylesheet" /-->
  <script type="text/javascript" src="hostable.js"></script>
</head>

<body>
</body>

<script type="text/javascript">
  var app = Elm.Hostable.init()

  let canvas = document.createElement("canvas");
  let context = canvas.getContext("2d");

  app.ports.getTextWidth.subscribe(function(params) {
    context.font = params.font;
    let metrics = context.measureText(params.text);
    app.ports.textSize.send({text: params.text, width: metrics.width})
  })

  app.ports.select.subscribe(function(id) {
    var el = document.getElementById(id)
    el.focus()
    el.select()
    try {
      if (!document.execCommand('copy')) {
        console.warn("copy failed")
      }
    } catch (err) {
      console.error("copy threw", err)
    }
  })

  var key = 'hostable'

  app.ports.localStorageSave.subscribe(function(value) {
    localStorage.setItem(key, value)
  })

  var loaded = localStorage.getItem(key)
  app.ports.localStorageLoaded.send(loaded)

  app.ports.read.subscribe(function(files) {
    for (var i = 0; i < files.length; i++) {
      var file = files[i]
      //console.log(file)
      var reader = new FileReader()
      reader.onload = function(e) {
        //console.log(e.target.result)
        app.ports.fileContents.send(e.target.result)
      }
      reader.readAsText(file)
    }
  })
</script>
<script defer src="svgxuse.js"></script>

</html>

